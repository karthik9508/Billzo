<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple PDF Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-success { background-color: #28a745; color: white; }
        .log { background: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; min-height: 200px; font-family: monospace; white-space: pre-line; }
    </style>
</head>
<body>
    <h1>Simple PDF Generation Test</h1>
    <p>This page tests the PDF generation functionality used in the invoice app.</p>
    
    <button class="btn btn-primary" onclick="loadJsPDF()">Load jsPDF Library</button>
    <button class="btn btn-success" onclick="generateTestPDF()">Generate Test PDF</button>
    
    <div id="log" class="log">Click "Load jsPDF Library" first, then "Generate Test PDF"</div>

    <script>
        const log = (message) => {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        window.loadJsPDF = async function() {
            log('üîÑ Loading jsPDF library...');
            
            if (window.jsPDF) {
                log('‚úÖ jsPDF already loaded');
                return;
            }

            try {
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js';
                
                const loadPromise = new Promise((resolve, reject) => {
                    script.onload = () => {
                        log('üì• Script loaded, checking availability...');
                        setTimeout(() => {
                            if (window.jsPDF && typeof window.jsPDF === 'function') {
                                log('‚úÖ jsPDF loaded successfully!');
                                resolve();
                            } else {
                                log('‚ùå jsPDF not available after loading');
                                reject(new Error('jsPDF not available'));
                            }
                        }, 100);
                    };
                    
                    script.onerror = () => {
                        log('‚ùå Failed to load jsPDF script');
                        reject(new Error('Script load failed'));
                    };
                });

                document.head.appendChild(script);
                await loadPromise;
                
            } catch (error) {
                log('‚ùå Error: ' + error.message);
            }
        };

        window.generateTestPDF = function() {
            log('üìÑ Generating test PDF...');
            
            if (!window.jsPDF) {
                log('‚ùå jsPDF not loaded. Click "Load jsPDF Library" first.');
                return;
            }

            try {
                const jsPDF = window.jsPDF;
                const doc = new jsPDF();
                
                log('‚úÖ PDF document created');

                // Add content
                doc.setFontSize(24);
                doc.text('TEST PDF DOCUMENT', 20, 30);
                
                doc.setFontSize(14);
                doc.text('This is a test PDF generated by the invoice app.', 20, 50);
                
                doc.setFontSize(12);
                doc.text('Generated on: ' + new Date().toLocaleString(), 20, 70);
                
                // Add some invoice-like content
                doc.text('Invoice Number: TEST-001', 20, 90);
                doc.text('Client: Test Client Company', 20, 105);
                doc.text('Amount: $1,234.56', 20, 120);
                
                log('‚úÖ Content added to PDF');

                // Save the PDF
                doc.save('test-invoice.pdf');
                log('üéâ PDF generated and downloaded successfully!');
                
            } catch (error) {
                log('‚ùå PDF generation failed: ' + error.message);
                log('Error details: ' + error.stack);
            }
        };

        log('PDF Test Ready! Click the buttons to test PDF generation.');
    </script>
</body>
</html>